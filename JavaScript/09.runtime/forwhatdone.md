## 프로세스

- 컴퓨터 위에서, 즉 운영체제 위에서 독립적으로 메모리에서 실행되고 있는 프로그램

    ex)

    - 음악재생 프로그램 || 사진뷰어 프로그램 (이런 프로그램들은 각각의 프로세스를 가짐)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ac59adde-7389-48ae-9639-fce4e3fe383b/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ac59adde-7389-48ae-9639-fce4e3fe383b/Untitled.png)

- 각각의 프로세스는 메모리 위에서 실행되며 독립적이다.
- 각각의 프로세스는 저마다, resource(자원)들이 정해져 있는데요, 즉 프로세스마다 할당된 메모리나 데이터들이 지정되어져 있습니다.
- 프로세스 안에는 프로그램을 위해서 작성된 코드(프로그램을 실행하기 위한 코드)와 그 프로세스 안에서 함수들이 어ㄸ너 순서로 실행되어야 하는지, 이함수가 끝나면 어디로 돌아가야하는지 저장되어 있는 stack 이 있고
- 힙은 우리가 오브젝트를 생성하거나 데이터를 만들 때, 그 데이터들이 저장되는 공간.
- 힙에는 동적으로 할당된 변수들이 저장되느 ㄴ반면에
- 데이터는 전역변수나, 스태틱 변수가 할당됨.
- 
- 즉, 각각의 프로세스는 자기들에게 필요한 코드, 동작하고 있는 순서를 기억하는 스택, 데이터들이 들어있는 힙과 데이터. 들이 들어져 있다.

## 쓰레드

- 쓰레드는 한 프로세스 안에서 여러개가 동작할 수 있다.
- 쓰레드는 각각 저마다 해야되는 업무를 배정받는다. (=일꾼 ㅋㅋㅋㅋ)
- 쓰레드는 자기들만의 수행해야하는 함수의 호출을 기억해야 하기 때문에 쓰레드마다 스택이 할당되어져 있다.
- 하지만 이 프로세스 안에서 동작하는 일꾼들 즉 쓰레드들은 결국은 한 프로그램을 위해서 일해야 되므로 프로세스에 지정된 코드와, 힙, 데이터에 공통적으로 접근해서 공통적으로 업데이트가 가능하게 된다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ab50b462-763f-42f5-b39b-52ae7541b442/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ab50b462-763f-42f5-b39b-52ae7541b442/Untitled.png)

ex)

- 프로그램 중에 음악을 들으면서 사진을 편집할 수 있는 어플리케이션이 있다면 각각 쓰레드,
    - 즉 음악을 재생하는 쓰레드 하나와
    - 사진을 편집할 수 잇는 쓰레드.
    - 음악의 데이터를 서버에서부터 받아와서 처리하는 쓰레드
- 위와 같이 한 프로그램 안에 여러 동작이 동시다발적으로 발생할 수 있기 때문에 이 프로세스가 조금 더 효율적으로 일할 수 있도록 도움을 준다.
- 만약에 프로세스가 하나의 일만 할 수 있다면.... 음악을 들으면서 사진 편집은 못하겠지...
- 이렇게 쓰레드들이 여러개 들어있기 때문에 다양한 일들을 동시에 할 수 있는 거임 ㅇㅇ

**중요**

- 쓰레드는 어디에서부터 어디까지 일을 했고 그 다음엔 어디로 가야되는지, 일의 흐름을 기억할 수 있는 고유의 스택이 지정되어져 있지만,
- 데이터나 코드나 힙 같은 공통적인 데이터 리소스는 프로세스에 안에 있기 때문에 쓰레드들은 이 프로세스에 공통적으로 할당된 리소스에 동시다발적으로 접속해서 동시다발적으로 업데이트 해야된다
- 멀티쓰레딩을 잘 못하면 공통적으로 업데이트 하면서 이 순서가 맞지 않거나 발생하는 문제가 있어서 멀티쓰레딩 프로그래밍이 조금 까다롭다.

    ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/65867e07-71b2-4861-bf71-3da213abd5d0/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/65867e07-71b2-4861-bf71-3da213abd5d0/Untitled.png)

## 결론

- 프로세스는 프로그래밍을 동작하는 최고의 단위
- 쓰레드는 프로그램 안에서 동시에 여러 개가 수행될 수 있는 작은 일꾼 단위

- 멀티쓰레딩이라는 것은
    - 한 프로세스 안에서 여러가지 쓰레드가 동시다발적으로 발생하는 것을 말한다
    - 그리고 이걸 가지고 있으면 동시적으로 일을 수행할 수 있기 때문에
    - 효율적으로 프로그래밍이 동작

- 자바라는 언어는 언어자체에서 멀티쓰레딩이 지원됨
    - 위 말은 우리가 프로그래밍을 짤 때 사용자가 이 데이터를 보고 있는 동안
        - 서버에서 데이터를 받아오는 것은 쓰레드 A가,
        - 다른 일은 쓰레드 B에서 해야지
    - 라고 각각 지정해서 프로그래밍을 짤 수 있다
- 자바로 멀티쓰레딩을 구현하려면 조금 배워야 되는 것들이 많다.

- 자바스크립트는 single threaded language. 이 언어 자체는 멀티 쓰레딩이 없다.
    - 그래서 자바에서 했던 것처럼,
        - 이 일은 백그라운드 쓰레드에서
        - 이 일은 쓰레드 A에서
        - 저 일은 쓰레드 B에서
    - 각각 지정할 수 있는 방법이 없음

- 자바스크립트 언어 자체는 멀티쓰레딩을 할 수 있는 방법은 없지만
- **자바스크립트가 동작하고 있는 브라우저 위에는 즉, 브라우저라는 프로그램 안에서는 여러가지 쓰레드가 들어 있음**
- 그래서 우리가 브라우저, 즉 web apis를 이용하게 되면 멀티쓰레딩이 가능하다.
- 자바스크립트가 동작하는 이 런타임 환경에서 즉, **자바스크립트가 동작하고 있는 실행환경**에서는 다양한 방식을 이용해서 멀티쓰레딩 같은 효과를 얻을 수 있다.
- 자바스크립트가 실행되는 이 런타임 환경 = 자바스크립트가 실행되는 실행 환경 위에서는 멀티쓰레딩 뿐만 아니라 이벤트 루프를 이용해서 조금 더 다양한 동작을 실행할 수 있다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/04c48b97-e531-4f2c-b861-550944173b45/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/04c48b97-e531-4f2c-b861-550944173b45/Untitled.png)

## 자바스크립트 런타임 환경

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/12ba9282-4289-4e62-9988-22b1b115e5de/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/12ba9282-4289-4e62-9988-22b1b115e5de/Untitled.png)

### 상황

- 웹어플리케이션이 브라우저 위에 올라가는 순간
- 이 자바스크립트 엔진이 우리가 작성한 소스코드를 한 줄 한줄 해석하고 분석하고 실행
- 이 과정이 어떻게 진행되는 걸까???

### 과정

- 자바스크립트 엔진은 크게 메모리 힙과 콜스택으로 나눠져 있다
- **메모리 힙**은
    - 우리가 데이터를 만들 때, 즉, 변수를 선언해서 오브젝트를 할당하거나 문자나 숫자를 할당하게 되면
    - 그 데이터들은 전부 다 메모리 힙에 저장된다.
    - 그런데 메모리 힙은 구조적으로 정리된 자료구조가 아니라 이렇게 자료들이 여기저기에 이렇게 아무곳에서나 저장되어져 있다.

        ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6e92ca9a-9d41-4ec8-9ffd-58678c6fbb1a/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6e92ca9a-9d41-4ec8-9ffd-58678c6fbb1a/Untitled.png)

    - 이렇게 할당된 데이터들이 결론적으로 메모리 힙에 들어가게 됨

- **콜스택**은
    - 우리가 실행하는 함수에 따라서 차곡차곡 쌓아놓음
    - 이렇게 메인 함수에서 first() 함수를 호출하고 seconnd()를 호출하면 이 콜스택에 차곡차곡 쌓이게 됨

        ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/766ad67e-0b2a-4d3a-840f-c8c88096150d/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/766ad67e-0b2a-4d3a-840f-c8c88096150d/Untitled.png)

**!잠깐**

- 스택은 LIFO(Last in First out) 라고도 불리는데 제일 나중에 들어온 것에 제일 먼저 나간다

    ex)

    - 보통 스택에는 push와 pop peek같은 API들이 있는데
    - push(1)이라고 하게 되면 1이라는 데이터가 스택에 들어가게 되고 push(2)하게 되면 1위에 2라는 데이터가 쌓이게 되는데, 이 때 pop()을 호출하게 되면 , (pop은 하나를 쏙 빼나가는 건데) 당연히 제일 나중에 들어온 제일 늦게 들어온 숫자 2가 나가게 된다.
- 이렇게 스택은 제일 나중에 들어온 것이 제일 먼저 나가는 자료구조를 가지고 있다.

- **콜스택 동작 과정**

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b6108e0c-1c35-4a45-a32c-94c67b6cfe72/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b6108e0c-1c35-4a45-a32c-94c67b6cfe72/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fc778f26-3027-4155-95bd-60ae1f930a67/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fc778f26-3027-4155-95bd-60ae1f930a67/Untitled.png)

- 콜스택은 어디로 돌아와야 되는지에 관한 정보도 포함
- 콜스택은 함수들이 호출하는 순서를 기억했다가 함수가 끝나면 원래 있던 자리로 돌아가기 위해서 쓰이는 자료구조중 하나이다.
- 모든 프로세스와 쓰레드 안에는 각각 저마다의 콜스택이 들어가 있다.
- 왜냐 일을 수행할 때 어디에서 왔고 어디로 다시 가야되는지 정보를 기억해야하기 때문이다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e0f6b327-8404-4003-acbb-8b84d59943cc/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e0f6b327-8404-4003-acbb-8b84d59943cc/Untitled.png)

- 위와 같은 경우는 콜스택이 어떻게 쌓일까?
- endless()가 계속 쌓이게 된다....

    콘솔창에서 maximun call stack size exceed 라는 오류를 확인할 수 있다. 

- **프로세스마다 스택마다 지정된 콜스택 사이즈가 있다.**
- 함수안에서 자기 자신을 부르는 함수를 재귀함수라고 하는데
- 이 재귀함수가 유용하지만 잘못쓰면 지정된 콜스택 사이즈를 초과할 수 있어야 되서 조심해서 써야 한다.

## 결론

우리가 작성한 웹어플리케이션이 브라우저 위에 올라 가게 되면 우리의 소스코드를 이 자바스크립트 엔진이 어떻게 해석하고 어떤 구조로 보관하는 지 알아보았음

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/12d84f64-eb5a-4a82-a34a-a3e883e2135c/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/12d84f64-eb5a-4a82-a34a-a3e883e2135c/Untitled.png)

- Web APIs는 브라우저에서 제공하는 api이기 때문에 **브라우저의 멀티쓰레딩을 이용해서 다양한 일들을 동시에 실행**할 수 가 있다.

    ex)

    - 대표적으로 fetch를 이용해서 백앤드에서 데이터를 받아 온다든지
    - setTimeout을 이용해서 일정 기간의 시간이 지난 다음에 우리가 등록한 콜백함수를 실행

## 웹 API와 자바스크립트 엔진 소통 과정

ex)

우리가 second()라는 함수 안에서 setTimeout을 호출했다고 가정해보자. 3초 있다가 우리가 콜백함수를 동륵해서 콘솔창에 'hello'를 출력한다고 가정해보자.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4d940720-f1d3-45ae-8369-429ffff01fd3/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4d940720-f1d3-45ae-8369-429ffff01fd3/Untitled.png)

- setTimeout()을 호출하는 순간 콜백에서 지워지고 웹 api는 타이머를 시작하게 된다
- 타이머가 실행되고 있는 동안에도, 즉 타이머와 자바스크립트 엔진은 병렬적으로 실행이 되고 있다가 지정된 시간이 끝나면 웹 api는 태스크 큐에 "야! 타이머 끝났어" 여기 네가 등록한 콜백이야. 이 콜백 자체를 태스크 큐에 집어 넣습니다.

    ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/201bcc9e-6a51-4a79-8ff0-14a6b1ac9c87/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/201bcc9e-6a51-4a79-8ff0-14a6b1ac9c87/Untitled.png)

    ### 여기서 태스크 큐란 무엇일까?

    - 큐도 자료구조 중 하나로
        - FIFO라고 알려져 있는데(First In First Out) 처음에 들어온것이 처음으로 나간다. 스택과 반대되네염..
        - 큐의 대표적인 api로는 add 와 remove가 있음

- 이렇게 지정된 setTimeout() 이 끝나게 되면, setTimeout을 호출할 때 등록한 콜백이 태스크 큐에 들어오게된다.
- 웹 apis는 우리가 등록한 콜백함수를 원하는 때에 지정된 시간에 알아서 태스크 큐에 넣어준다. 그럼 태스크 큐에 들어잇는 저 콜백은 언제 실행될까?
- 이렇게 **태스큐 큐와 콜스택을 관찰하는 아이가 하나 있는데!! 걔가 바로 event loop**이다.

## 이벤트 루프

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/39e8907d-4451-4d14-a355-887c7bbcea60/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/39e8907d-4451-4d14-a355-887c7bbcea60/Untitled.png)

- 이벤트 루프는 while이나 for loop 같이 이런 루프를 계속 돌면서 콜스택과 이 태스크 큐를 관찰함
- 이 이벤트 루프는 돌다가 콜스택에 아직 뭔가 일이 남아 있으면 콜스택이 비워질때까지 기다리고 콜 스택이 다 비워져서 자바스크립트 엔진이 더 이상 일을 하지 않을 때, 큐 안에 있던 아이를 콜 스택으로 데리고 온다.

    ? 여기서 궁금한것! setTimeout에서 3초 뒤에 콘솔창에 hello라고 출력하는 콜백함수를 등록했는데, 이 말은 즉, 3초 뒤에 콜백함수로 태스크 큐에 들어고가 콜 스택에 있는 main()함수까지 다 실행되고 나서 콘솔창에 hello를 찍는 콜백함수가 실행되는 것인가? 즉? 3초 뒤에 콘솔창에 hello가 찍히는 것이 아니라 결국은 콜스택에 있는 것들이 다 실행이 되고 나서 콜백함수가 실행되는 것이니 3초보다 더 늦게 실행이 될 수 도 있는 것인가?

- 그러면 자바스크립트 엔진이 콜 스택에 들어온 timeout callback 이라는 것을 실행하게 됨

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/11886c9c-a342-4da6-998f-a1e77b8588f1/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/11886c9c-a342-4da6-998f-a1e77b8588f1/Untitled.png)

### 결론적으로

이벤트 루프는 프로세스가 동작하는 동안 계속 루프를 돌면서 콜스택이 비어져 있다면 태스크 큐에 들어가 잇는 아이를 콜스택으로 가져와서 자바스크립트 엔진이 수행할 수 있도록 도와준다

## 결론

웹 API중 하나인 setTimeout 또는 setInerval, addClickListener 이런 아이들을 쓸 때 우리가 지정한 콜백함수를 등록해놓으면 원하는 이벤트가 발생하면 바로 웹 APIs는 태스크 큐에 우리가 등록한 콜백함수를 큐 안으로 집어넣고

이벤트 루프는 빙글빙글 돌면서 콜스택이 비어져 잇으면 태스크 큐에 있는 아이를 하나만 가지고 와서 콜 스택에 넣어준다.

이런식으로 자바스크립트 엔진과 웹 APIs 가 동작함


- **콜 스택에서 수행중인 task는 끝날 때까지 보장이 된다**

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/01036d4d-b91d-431d-a651-407a55466959/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/01036d4d-b91d-431d-a651-407a55466959/Untitled.png)

## Microtask Queue

- 태스크 큐는 웹 APIs에서 우리가 등록한 콜백함수를 지정된 이벤트가 발생했을 때 태스크 큐에 넣는 것
- 마이크로 태스크 큐는 프로미스에 등록된 콜백, 즉 **프로미스가 다 수행되고 나면 그 다음에 등록한 then에 등록한 콜백함수**, **mutation observer(웹 API중 하나)에 등록된 콜백**이 마이크로 태스크 큐에 들어오게 됩니다.

    ex)

    - 만약 백엔드에서 데이터를 받아오는 fetch를 이용해서 프로미스를 만들고 프**로미스에 then**이라고 콜백 함수를 등록해 놓았다 가정해보자
    - 프로미스가 잘 끝나서 resolve가 되면 그 때 등록된 콜백이 바로 마이크로 태스크 큐에 들어오게 된다

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a04684ee-dbf2-44ab-a8e2-f993baf657d3/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a04684ee-dbf2-44ab-a8e2-f993baf657d3/Untitled.png)

## Render Sequence

- 렌더는 브라우저에서 우리가 변형한 코드가 주기적으로 업데이트 되기 위해서 주기적으로 호출되는 순서인데 그 전에 우리가 Request Animation Frame이라는 API를 부르면 그 때 우리가 등록한 콜백은 이 리퀘스트 애니메이션 프레임 안에 있는 큐에 차곡차곡 쌓인다

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b5db9cdd-1d52-4f07-a17d-1994445eaba2/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b5db9cdd-1d52-4f07-a17d-1994445eaba2/Untitled.png)
